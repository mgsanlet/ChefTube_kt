package com.mgsanlet.cheftube.ui.auth

import android.content.Intent
import android.os.Bundle
import android.os.Handler
import android.view.View
import android.view.animation.Animation
import android.view.animation.AnimationUtils
import android.widget.ImageView
import androidx.activity.enableEdgeToEdge
import androidx.appcompat.app.AppCompatActivity
import androidx.core.view.ViewCompat
import androidx.core.view.WindowInsetsCompat
import com.mgsanlet.cheftube.R
import java.util.Locale

/**
 * SplashActivity is the introductory screen that appears when the application starts.
 * It displays a splash screen with an animated logo and title. The animations are applied
 * to the logo and title images using the `Animation` class, and after a delay, the activity
 * transitions to the next screen, `AuthActivity`.
 * @author MarioG
 */
class SplashActivity : AppCompatActivity() {
    // -Declaring UI elements-
    lateinit var logoImg
    var titleImg: ImageView? = null

    // -Declaring animations-
    var animationLogo: Animation? = null
    var animationTitle: Animation? = null
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        // Load the saved language and apply the locale
        applySavedLocale()

        this.enableEdgeToEdge()
        setContentView(R.layout.activity_splash)
        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main)) { v: View, insets: WindowInsetsCompat ->
            val systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars())
            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom)
            insets
        }
        // -Binding attributes to XML views-
        logoImg = findViewById(R.id.splash_logo)
        titleImg = findViewById(R.id.splash_title)
        // -Loading animations-
        animationLogo = AnimationUtils.loadAnimation(this, R.anim.splash_logo_anim)
        animationTitle = AnimationUtils.loadAnimation(this, R.anim.splash_title_anim)
        // -Starting animations-
        logoImg.startAnimation(animationLogo)
        titleImg.startAnimation(animationTitle)
        // -Delaying the start of the next activity-
        Handler().postDelayed({
            startActivity(Intent(this@SplashActivity, AuthActivity::class.java))
            finish()
        }, 2100)
    }

    /**
     * Applies the saved language from SharedPreferences to the current configuration.
     */
    private fun applySavedLocale() {
        val preferences = getSharedPreferences(PREFS_NAME, MODE_PRIVATE)
        val languageCode = preferences.getString(LANGUAGE_KEY, Locale.getDefault().language)
        val res = resources
        val config = res.configuration
        val locale = Locale(languageCode)
        config.setLocale(locale)
        res.updateConfiguration(config, res.displayMetrics)
    }

    companion object {
        // -Declaring shared preferences data-
        private const val PREFS_NAME = "AppPrefs"
        private const val LANGUAGE_KEY = "language"
    }
}